<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hello Terraform Data; Goodbye Null Resource | devDosvid blog</title>
<meta name=keywords content="terraform,null_resource,terraform_data,terraform_1.4,new release,infrastructure as code"><meta name=description content="Native built-in replacement for null_resource with Terraform 1.4"><meta name=author content="Serhii Vasylenko"><link rel=canonical href=https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/><link crossorigin=anonymous href=/assets/css/stylesheet.51adfef0209146fea88d574556a024fb0fe75550725c247200ff67f0bd77de4a.css integrity="sha256-Ua3+8CCRRv6ojVdFVqAk+w/nVVByXCRyAP9n8L133ko=" rel="preload stylesheet" as=style><link rel=icon href=https://devdosvid.blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://devdosvid.blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://devdosvid.blog/favicon-32x32.png><link rel=apple-touch-icon href=https://devdosvid.blog/apple-touch-icon.png><link rel=mask-icon href=https://devdosvid.blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><style>@font-face{font-family:albert sans;font-style:normal;font-display:swap;font-weight:300;src:url(/assets/fonts/AlbertSans-Light.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:italic;font-display:swap;font-weight:300;src:url(/assets/fonts/AlbertSans-LightItalic.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/fonts/AlbertSans-Regular.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:italic;font-display:swap;font-weight:400;src:url(/assets/fonts/AlbertSans-Italic.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:normal;font-display:swap;font-weight:500;src:url(/assets/fonts/AlbertSans-Medium.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:italic;font-display:swap;font-weight:500;src:url(/assets/fonts/AlbertSans-MediumItalic.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:normal;font-display:swap;font-weight:600;src:url(/assets/fonts/AlbertSans-SemiBold.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:italic;font-display:swap;font-weight:600;src:url(/assets/fonts/AlbertSans-SemiBoldItalic.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><meta name=twitter:creator content="@vasylenko"><meta name=twitter:site content="@vasylenko"><script defer type=text/javascript>window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{},n=document.createElement("script"),n.type="text/javascript",n.async=!0,n.src="https://cdn.heapanalytics.com/js/heap-"+e+".js",o=document.getElementsByTagName("script")[0],o.parentNode.insertBefore(n,o);for(var n,o,a=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},i=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],s=0;s<i.length;s++)heap[i[s]]=a(i[s])},heap.load("2300872157")</script><meta property="og:title" content="Hello Terraform Data; Goodbye Null Resource"><meta property="og:description" content="Native built-in replacement for null_resource with Terraform 1.4"><meta property="og:type" content="article"><meta property="og:url" content="https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/"><meta property="og:image" content="https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-16T01:25:18+02:00"><meta property="article:modified_time" content="2024-05-09T19:20:55+02:00"><meta property="og:site_name" content="devDosvid blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image.png"><meta name=twitter:title content="Hello Terraform Data; Goodbye Null Resource"><meta name=twitter:description content="Native built-in replacement for null_resource with Terraform 1.4"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://devdosvid.blog/posts/"},{"@type":"ListItem","position":2,"name":"Hello Terraform Data; Goodbye Null Resource","item":"https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hello Terraform Data; Goodbye Null Resource","name":"Hello Terraform Data; Goodbye Null Resource","description":"Native built-in replacement for null_resource with Terraform 1.4","keywords":["terraform","null_resource","terraform_data","terraform_1.4","new release","infrastructure as code"],"articleBody":"Terraform version 1.4 was recently released and brought a range of new features, including improved run output in Terraform Cloud, the ability to use OPA policy results in the CLI, and a built-in alternative to the null resource — terraform_data.\nIn this blog post, I want to demonstrate and explain the terraform_data resource that serves two purposes:\nfirstly, it allows arbitrary values to be stored and used afterward to implement lifecycle triggers of other resources secondly, it can be used to trigger provisioners when there isn’t a more appropriate managed resource available. Subscribe to blog updates! For those of you, who are familiar with the null provider, the terraform_data resource might look very similar. And you’re right!\nRather than being a separate provider, the terraform_data managed resource now offers the same capabilities as an integrated feature. Pretty cool! While the null provider is still available and there are no statements about its deprecation thus far (as of April 2023, v3.2.1), the terraform_data is the native replacement of the null_resource, and the latter might soon become deprecated.\nThe terraform_data resource has two optional arguments, input and triggers_replace, and its configuration looks as follows:\nterraform data resource arguments\nThe input (optional) stores the value that is passed to the resource The triggers_replace (optional) is a value that triggers resource replacement when changes. There are two attributes, in addition to the arguments, which are stored in the state: id and output after the resource is created. Let’s take a look:\nterraform data resource attributes\nThe output attribute is computed based on the value of the input The id is just a unique value of the resource instance in the state (as for any other resource). Use case for terraform_data with replace_triggered_by Let’s take a look at the first use case for the terraform_data resource. It is the ability to trigger resource replacement based on the value of the input argument.\nA bit of context here: the replace_triggered_by argument of the resource lifecycle meta-argument allows you to trigger resource replacement based on another referenced resource or its attribute.\nIf you are not yet familiar with the replace_triggered_by, you can check another blog post that explains it. The replace_triggered_by is a powerful feature, but here is the thing about it: only a resource or its attribute must be specified, and you cannot use a variable or a local value for replace_triggered_by.\nBut with terraform_data, you can indirectly initiate another resource replacement by using either a variable or an expression within a local value for the input argument.\nLet me give you an example here. Consider the following code:\ntrigger replacement based on input variable\nBy modifying the revision variable, the next Terraform plan will suggest a replacement action against aws_instance.webserver:\nterraform_data with replace_triggered_by\nUse case for terraform_data with provisioner Before we start: HashiCorp suggests (and I also support that) avoiding provisioner usage unless you have no other options left. One of the reasons — additional, implicit, and unobvious dependency that appears in the codebase — the binary, which is called inside the provisioner block, must be present on the machine. But let’s be real, the provisioner feature is still kicking, and there’s always that one unique project that needs it.\nHere is the code snippet that demonstrates the usage of the provisioner within the terraform_data resource:\nterraform_data with provisioner\nIn this example, the following happens:\nWhen resources are created the first time, the provisioner inside terraform_data runs Sequential plan/apply will trigger another execution of the provisioner only when the private IP of the instance (aws_instance.webserver.private_ip) changes because that will trigger terraform_data recreation. At the same time, no changes to the internal IP mean no provisioner execution. With its ability to store and use values for lifecycle triggers and provisioners, terraform_data is a powerful tool that can enhance your Terraform configuration.\nAlthough the null provider still has its place in the Terraform ecosystem, terraform_data is its evolution, and its integration as a feature is certainly something to be excited about.\nWhy not give it a try in your next project and see how it can simplify your infrastructure as code workflows? Keep on coding! 🙌\n","wordCount":"689","inLanguage":"en","image":"https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image.png","datePublished":"2023-04-16T01:25:18+02:00","dateModified":"2024-05-09T19:20:55+02:00","author":{"@type":"Person","name":"Serhii Vasylenko"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/"},"publisher":{"@type":"Person","name":"devDosvid blog","logo":{"@type":"ImageObject","url":"https://devdosvid.blog/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://devdosvid.blog/ accesskey=h title="🏠 Home (Alt + H)">🏠 Home</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://devdosvid.blog/index.xml title="RSS Feed"><span>RSS Feed</span></a></li><li><a href=https://devdosvid.blog/archive title="All posts"><span>All posts</span></a></li><li><a href=https://devdosvid.blog/about/ title="About me"><span>About me</span></a></li><li><a href=https://devdosvid.blog/series title="Post Series"><span>Post Series</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://devdosvid.blog/>Home</a>&nbsp;»&nbsp;<a href=https://devdosvid.blog/posts/>Posts</a></div><h1 class=post-title>Hello Terraform Data; Goodbye Null Resource</h1><div class=post-description>Native built-in replacement for null_resource with Terraform 1.4</div><div class=post-meta><span title='2023-04-16 01:25:18 +0200 +0200'>April 16, 2023</span>&nbsp;·&nbsp;Serhii Vasylenko&nbsp;|&nbsp;<a href=mailto:contact@devdosvid.blog rel="noopener noreferrer" target=_blank>Contact me</a></div></header><figure class=entry-cover><img srcset="https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image_hu00cad91830066a46f8268a3dcb54e3a6_43211_360x0_resize_box_3.png 360w ,https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image_hu00cad91830066a46f8268a3dcb54e3a6_43211_480x0_resize_box_3.png 480w ,https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image_hu00cad91830066a46f8268a3dcb54e3a6_43211_720x0_resize_box_3.png 720w ,https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image_hu00cad91830066a46f8268a3dcb54e3a6_43211_1080x0_resize_box_3.png 1080w ,https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image.png 1200w" sizes="(min-width: 768px) 720px, 100vw" src=https://devdosvid.blog/2023/04/16/hello-terraform-data-goodbye-null-resource/cover-image.png alt="Native built-in replacement for null_resource with Terraform 1.4" width=1200 height=630></figure><div class=post-content><p>Terraform version 1.4 was recently released and brought a range of new features, including improved run output in Terraform Cloud, the ability to use OPA policy results in the CLI, and a built-in alternative to the null resource — terraform_data.</p><p>In this blog post, I want to demonstrate and explain the <strong>terraform_data</strong> resource that serves two purposes:</p><ul><li>firstly, it allows arbitrary values to be stored and used afterward to implement lifecycle triggers of other resources</li><li>secondly, it can be used to trigger provisioners when there isn&rsquo;t a more appropriate managed resource available.</li></ul><div class=substack-embedded-container><h3>Subscribe to blog updates!</h3><iframe title=Substack class=substack-embedded-iframe src=https://devdosvid.substack.com/embed height=250 loading=lazy></iframe></div><p>For those of you, who are familiar with the null provider, the <code>terraform_data</code> resource might look very similar. And you&rsquo;re right!<br>Rather than being a separate provider, the terraform_data managed resource now offers the same capabilities as an integrated feature. Pretty cool!<br>While the null provider is still available and there are no statements about its deprecation thus far (<a href=https://registry.terraform.io/providers/hashicorp/null/3.2.1/docs>as of April 2023, v3.2.1</a>), the <code>terraform_data</code> is the native replacement of the <code>null_resource</code>, and the latter might soon become deprecated.</p><p>The <code>terraform_data</code> resource has two optional arguments, <strong>input</strong> and <strong>triggers_replace</strong>, and its configuration looks as follows:</p><figure><img loading=lazy src=code-snippet-1.png alt="terraform data resource arguments" width=800 height=182.16><figcaption><p>terraform data resource arguments</p></figcaption></figure><ul><li>The <code>input</code> (optional) stores the value that is passed to the resource</li><li>The <code>triggers_replace</code> (optional) is a value that triggers resource replacement when changes.</li></ul><p>There are two attributes, in addition to the arguments, which are stored in the state: <strong>id</strong> and <strong>output</strong> after the resource is created. Let&rsquo;s take a look:</p><figure><img loading=lazy src=code-snippet-2.png alt="terraform data resource attributes" width=800 height=271.36><figcaption><p>terraform data resource attributes</p></figcaption></figure><ul><li>The <code>output</code> attribute is computed based on the value of the <code>input</code></li><li>The <code>id</code> is just a unique value of the resource instance in the state (as for any other resource).</li></ul><h2 id=use-case-for-terraform_data-with-replace_triggered_by>Use case for terraform_data with replace_triggered_by<a hidden class=anchor aria-hidden=true href=#use-case-for-terraform_data-with-replace_triggered_by>#</a></h2><p>Let&rsquo;s take a look at the first use case for the terraform_data resource. It is the ability to trigger resource replacement based on the value of the input argument.</p><p>A bit of context here: the <strong>replace_triggered_by</strong> argument of the resource lifecycle meta-argument allows you to trigger resource replacement based on another referenced resource or its attribute.</p><div class=attention>If you are not yet familiar with the <code>replace_triggered_by</code>, you can check <a href=/2022/05/04/new-lifecycle-options-and-refactoring-capabilities-in-terraform-1-1-and-1-2/#trigger-resource-replacement-with-replace_triggered_by>another blog post that explains it</a>.</div><p>The replace_triggered_by is a powerful feature, but here is the thing about it: only a resource or its attribute must be specified, and <strong>you cannot use a variable or a local value for replace_triggered_by</strong>.</p><p>But with terraform_data, you can indirectly initiate another resource replacement by using either a variable or an expression within a local value for the <code>input</code> argument.</p><p>Let me give you an example here. Consider the following code:</p><figure><img loading=lazy src=code-snippet-3.png alt="trigger replacement based on input variable" width=800 height=386.00><figcaption><p>trigger replacement based on input variable</p></figcaption></figure><p>By modifying the <code>revision</code> variable, the next Terraform plan will suggest a replacement action against aws_instance.webserver:</p><figure><img loading=lazy src=code-snippet-4.png alt="terraform_data with replace_triggered_by" width=800 height=341.59><figcaption><p>terraform_data with replace_triggered_by</p></figcaption></figure><h2 id=use-case-for-terraform_data-with-provisioner>Use case for terraform_data with provisioner<a hidden class=anchor aria-hidden=true href=#use-case-for-terraform_data-with-provisioner>#</a></h2><p>Before we start: HashiCorp suggests (and I also support that) avoiding provisioner usage unless you have no other options left. One of the reasons — additional, implicit, and unobvious dependency that appears in the codebase — the binary, which is called inside the provisioner block, must be present on the machine.<br>But let&rsquo;s be real, the provisioner feature is still kicking, and there&rsquo;s always that one unique project that needs it.</p><p>Here is the code snippet that demonstrates the usage of the provisioner within the terraform_data resource:</p><figure><img loading=lazy src=code-snippet-5.png alt="terraform_data with provisioner" width=800 height=409.00><figcaption><p>terraform_data with provisioner</p></figcaption></figure><p>In this example, the following happens:</p><ul><li>When resources are created the first time, the provisioner inside <code>terraform_data</code> runs</li><li>Sequential plan/apply will trigger another execution of the provisioner only when the private IP of the instance (aws_instance.webserver.private_ip) changes because that will trigger <code>terraform_data</code> recreation. At the same time, no changes to the internal IP mean no provisioner execution.</li></ul><hr><p>With its ability to store and use values for lifecycle triggers and provisioners, <strong>terraform_data</strong> is a powerful tool that can enhance your Terraform configuration.</p><p>Although the null provider still has its place in the Terraform ecosystem, terraform_data is its evolution, and its integration as a feature is certainly something to be excited about.</p><p>Why not give it a try in your next project and see how it can simplify your infrastructure as code workflows? Keep on coding! 🙌</p></div><footer class=post-footer><div class=substack-embedded-container><h3>Subscribe to blog updates!</h3><iframe title=Substack class=substack-embedded-iframe src=https://devdosvid.substack.com/embed height=250 loading=lazy></iframe></div><script src=https://giscus.app/client.js data-repo=vasylenko/devdosvid.blog data-repo-id="MDEwOlJlcG9zaXRvcnkyNDUyNTMxODE=" data-category=General data-category-id=DIC_kwDODp5EPc4CA59c data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=en data-theme=purge crossorigin=anonymous async></script><div class=post-series><p>Check out other posts of the <b>"Terraform Proficiency"</b> series:</p><ul></ul></div><ul class=post-tags></ul><div class=license><p>This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nd/4.0/>Creative Commons Attribution-NoDerivatives 4.0 International License</a></p></div><nav class=paginav><a class=prev href=https://devdosvid.blog/2024/01/09/mastering-aws-api-gateway-v2-http-and-aws-lambda-with-terraform/><span class=title>« Prev</span><br><span>Mastering AWS API Gateway V2 HTTP and AWS Lambda With Terraform</span>
</a><a class=next href=https://devdosvid.blog/2022/07/24/five-practical-ways-to-get-the-verified-ec2-ami/><span class=title>Next »</span><br><span>Five Practical Ways To Get The Verified EC2 AMI</span></a></nav></footer></article></main><footer class=footer><div style=width:10em;margin:auto><p style=background-color:#0082ca;color:#fff>From Ukrainian</p><p style=background-color:#ffb548;color:#fff>with love ❤️</p></div><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>