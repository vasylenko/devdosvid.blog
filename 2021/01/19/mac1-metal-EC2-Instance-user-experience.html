<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>mac1.metal and mac2.metal EC2 Instances — user experience | devDosvid — my engineering experience</title><meta name=keywords content="aws,macos,ec2"><meta name=description content="Apple macOS development ecosystem with the power of AWS Cloud"><meta name=author content="Serhii Vasylenko"><link rel=canonical href=https://devdosvid.blog/2021/01/19/mac1-metal-EC2-Instance-user-experience.html><link crossorigin=anonymous href=/assets/css/stylesheet.d94f86f740646188b4e229257a79d3c67d3290ae514458abf9a131490e6cb3ef.css integrity="sha256-2U+G90BkYYi04iklennTxn0ykK5RRFir+aExSQ5ss+8=" rel="preload stylesheet" as=style><link rel=icon href=https://devdosvid.blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://devdosvid.blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://devdosvid.blog/favicon-32x32.png><link rel=apple-touch-icon href=https://devdosvid.blog/apple-touch-icon.png><link rel=mask-icon href=https://devdosvid.blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><style>@font-face{font-family:albert sans;font-style:normal;font-display:swap;font-weight:300;src:url(/assets/fonts/AlbertSans-Light.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:italic;font-display:swap;font-weight:300;src:url(/assets/fonts/AlbertSans-LightItalic.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/fonts/AlbertSans-Regular.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:italic;font-display:swap;font-weight:400;src:url(/assets/fonts/AlbertSans-Italic.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:normal;font-display:swap;font-weight:500;src:url(/assets/fonts/AlbertSans-Medium.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:italic;font-display:swap;font-weight:500;src:url(/assets/fonts/AlbertSans-MediumItalic.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:normal;font-display:swap;font-weight:600;src:url(/assets/fonts/AlbertSans-SemiBold.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:albert sans;font-style:italic;font-display:swap;font-weight:600;src:url(/assets/fonts/AlbertSans-SemiBoldItalic.woff2)format('woff');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><meta name=twitter:creator content="@vasylenko"><meta name=twitter:site content="@vasylenko"><script type=text/javascript>window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{},n=document.createElement("script"),n.type="text/javascript",n.async=!0,n.src="https://cdn.heapanalytics.com/js/heap-"+e+".js",o=document.getElementsByTagName("script")[0],o.parentNode.insertBefore(n,o);for(var n,o,a=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},i=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],s=0;s<i.length;s++)heap[i[s]]=a(i[s])},heap.load("2300872157")</script><meta property="og:title" content="mac1.metal and mac2.metal EC2 Instances — user experience"><meta property="og:description" content="Apple macOS development ecosystem with the power of AWS Cloud"><meta property="og:type" content="article"><meta property="og:url" content="https://devdosvid.blog/2021/01/19/mac1-metal-EC2-Instance-user-experience.html"><meta property="og:image" content="https://devdosvid.blog/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-19T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-09T02:34:02+02:00"><meta property="og:site_name" content="devDosvid — my engineering experience"><meta property="og:see_also" content="https://devdosvid.blog/2021/10/24/auto-scaling-group-for-your-macos-ec2-instances-fleet/"><meta property="og:see_also" content="https://devdosvid.blog/2021/05/27/run-ansible-playbook-on-mac1.metal-instances-fleet-with-aws-systems-manager/"><meta property="og:see_also" content="https://devdosvid.blog/2021/02/01/customizing-mac1-metal-ec2-ami.html"><meta property="og:see_also" content="https://devdosvid.blog/2021/01/20/terraforming-mac1-metal-at-AWS.html"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://devdosvid.blog/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg"><meta name=twitter:title content="mac1.metal and mac2.metal EC2 Instances — user experience"><meta name=twitter:description content="Apple macOS development ecosystem with the power of AWS Cloud"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://devdosvid.blog/posts/"},{"@type":"ListItem","position":3,"name":"mac1.metal and mac2.metal EC2 Instances — user experience","item":"https://devdosvid.blog/2021/01/19/mac1-metal-EC2-Instance-user-experience.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"mac1.metal and mac2.metal EC2 Instances — user experience","name":"mac1.metal and mac2.metal EC2 Instances — user experience","description":"Apple macOS development ecosystem with the power of AWS Cloud","keywords":["aws","macos","ec2"],"articleBody":"This is the review of EC2 Mac instances, mac1.metal and mac2.metal — the new EC2 instance types that enables macOS workloads on AWS.\nUpdated in June 2022: new information added about the offering — more cool stuff 🤩 AWS announced EC2 macOS instances based on the Intel CPU on 30 November 2020.\nAfter a year and a half, the M1 Mac Instances arrived (7 July 2022).\nSome basic information about the Mac EC2 first:\nThe mac1.metal instances are Intel-based\n12 vCPU, 32 GiB RAM | 10 Gbps Network and 8 Gbps EBS bandwidth\nThe mac2.metal instances are powered by M1 Apple Silicon processors.\n8 vCPU, 16 GiB RAM, 16 core Apple Neural Engine | 10 Gbps Network and 8 Gbps EBS bandwidth\nThe Instance must be placed onto a Dedicated Host because these are physical Apple Mac minis.\nAWS has integrated the Nitro System to make Macs work as EC2 instances and connect them with many other services.\nMac minis are connected to the AWS Nitro via Thunderbolt, just a fun fact.\nYou don’t pay anything for the Instance itself, but you pay for the Dedicated Host leasing, and the minimum lease time is 24 hours.\nEC2 Mac Instance Prices (June 2022) On-demand pricing (us-east-1, North Virginia:\nmac1.metal costs 1.083 USD per hour or about 780 USD per month mac2.metal costs 0.65 USD per hour or about 470 USD per month The mac2.metal costs 40% less compared to the mac1.metal Since the minimal leas time for the mac*.metal dedicated host is 24 hours, the first launch of the Instance is always costly, mind that while testing.\nOne day of mac1.metal usage costs 26 USD\nOne day of mac2.metal usage costs 15.6 USD\nTo save yourself some money, you can use Savings Plans, both Instance and Compute, and save up to 44% off On-Demand pricing.\nFor example, with the one-year commitment, partial 50% upfront payment, and the Instance Savings pricing model, you can get the 20% lower price per hour:\nmac1.metal — 0.867 USD mac2.metal — 0.52 USD Feel free to play with the numbers in the Dedicated Host Pricing Calculator\nSupported Operating Systems (June 2022) macOS Mojave 10.14.x (mac1.metal only) macOS Catalina 10.15.x (mac1.metal only) macOS Big Sur 11.x macOS Monterey 12.x What can it do Here is a list of some features that the mac1.metal and mac2.metal instances have:\nIt lives in your VPC because it is an EC2 Instance, so you can access many other services.\nFor EBS, it supports the attachment of up to 16 volumes for mac1 and 10 for mac2.\nIt supports SSM Agent and Session Manager.\nIt has several AWS tools pre-installed: AWS CLI, SSM Agent, EFS Utils, and more.\nIt has pre-installed Enhanced Network Interface drivers. My test upload/download to S3 was about 300GB/s.\nIt can report CPU metrics to CloudWatch.\nIt supports AutoScaling 🚀\nAnd you can share the instances using AWS Resource Access Manager.\nFor example, you can have a dedicated AWS account used solely as a MacOS-based farm in your organization where instances are shared with other accounts.\nAlthough there is a local SSD disk available, EC2 Mac can boot only from the EBS\nThe built-it physical SSD is still there and yours to use: build-cache, temporary storage, etc.\nHowever, AWS does not manage or support the Apple hardware’s internal SSD. So there is no guarantee for data persistency.\nWhat can’t it do It can’t recognize the attached EBS if you connected it while the instance was running — you must reboot the instance to make it visible. It does not recognize the live resize of EBS either — you must reboot the instance so resize change can take effect. And the same relates to the Elastic Network Interfaces — attach and reboot the instance to apply it. It does not support several services that rely on additional custom software, such as “EC2 Instance Connect” and “AWS Inspect.” But I think that AWS will add macOS distros for those soon. Launching the Instance Jeff Bar published an excellent how-to about kickstart of the “mac1.metal”, so I will focus on things he did not mention.\nOnce you allocated the Dedicated Host and launched an Instance, the underlying system connects the EBS with a root file system to the Mac Mini.\nThe Mac metal Instances can boot from the EBS-backed macOS AMIs only.\nIf you specified the EBS size to be more than AMI’s default, you need to resize the disk inside the system manually after the boot 1.\nThe time from the Instance launch until you can SSH into it varies between 5 and 20 minutes.\nYou have the option to access it over SSH with your private key. For example, if you need to set up Screen Sharing, you must allow it through the “kickstart” command-line utility and set the user password 2.\nCustomizing the Instance I wrote a separate post about mac1.metal AMI customization and creation, so check it out!\nCustomizing mac1.metal EC2 AMI — new guts, more glory\nThough, I would like to mention two things here:\nSystem updates are disabled by default in the macOS AMIs provided by AWS. But you can use them with no issues. For example:\nsudo softwareupdate --install --all It is possible to set a custom screen resolution when connected to the instance using native ScreenSharing or any other VNC-compatible software. There are many tools, but AWS suggests the displayplacer.\nDestroying the Instance Such an easy thing to do, right? Well, it depends.\nThe complex Instance scrubbing process begins when you click on the “Terminate” item in the Instance actions menu.\nAWS wants to ensure that anyone who uses the Host (Mac mini) after you will get your data stored neither on disks (including the physical SSD mentioned earlier) nor inside memory or NVRAM, nor anywhere else.\nAWS does not share many details of this scrubbing process, but it takes more than an hour to complete.\nWhen scrubbing is started, the Dedicated Host transitions to the Pending state.\nDedicated Host transitions to Available state once scrubbing is finished. But you must wait for another 10-15 minutes to be able to release it finally.\nI don’t know why they set the Available state value earlier than the Host is available for operations, but this is how it works now (Jan'21).\nTherefore, you can launch the next Instance on the same Host no earlier than ~1,5 hours after you terminated the previous one. That doesn’t seem very pleasant in the first couple of weeks, but you will get used to it. 😄\nAnd again: you can release the “mac1.metal” Dedicated Host no earlier than 24 hours after it was allocated. So plan your tests wisely.\nIf the lease time of a host is more than 24 hours, you don’t need to wait for the scrubbing process to finish to release that host. Legal things It is a bit tricky thing, but in short words:\nyou are allowed to use the Instances solely for developer purposes you must agree to all software EULAs on the system Here is the license agreement of the macOS Monterey if you want to deal with it like a pro — link.\nSome more cool stuff to check: EC2 macOS Init launch daemon, which initializes Mac instances. EC2 macOS Homebrew Tap (Third-Party Repository) with several management tools which come pre-installed into macOS AMI from AWS.\nIndeed it is powerful, and it has its trade-offs, such as price and some technical constraints. But it is an actual macOS device natively integrated into the AWS environment. So I guess it is worth to be tried!\nThanks for reading this! Stay tuned for more user experience feedback about baking custom AMIs, automated software provisioning with Ansible, and other adventures with mac1.metal!\nHow to resize the EBS at mac1.metal in Terminal\nGet the identifier of EBS (look for the first one with GUID_partition_scheme): diskutil list physical external\nOr here is a more advanced version to be used in a script:\nDISK_ID=$(diskutil list physical external | grep 'GUID_partition_scheme'| tr -s ' ' | cut -d' ' -f6) It would probably be disk0 if you did not attach additional EBS.\nThen run the repair job for the disk, using its identifier: diskutil repairDisk disk0\nAdvanced version:\nyes | diskutil repairDisk $DISK_ID Now get the APFS container identifier (look for Apple_APFS): diskutil list physical external\nAdvanced version:\nAPFS_ID=$(diskutil list physical external | grep 'Apple_APFS' | tr -s ' ' | cut -d' ' -f8) It would probably be disk0s2 if you did not attach additional EBS.\nFinally, resize the APFS container: diskutil apfs resizeContainer disk0s2\nAdvanced version\ndiskutil apfs resizeContainer $APFS_ID ↩︎ How to setup Screen Sharing at mac1.metal in Terminal\nThe kickstart command-line tool resides in /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/ so you’ll better to cd into that directory for convenience:\n# Turn On Remote Management for a user to be specified later sudo ./kickstart -activate -configure -allowAccessFor -specifiedUsers # Enable Remote Management for ec2-user user sudo ./kickstart -configure -users ec2-user -access -on -privs -all # Set the user password sudo passwd ec2-user ↩︎ ","wordCount":"1503","inLanguage":"en","image":"https://devdosvid.blog/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg","datePublished":"2021-01-19T00:00:00Z","dateModified":"2022-07-09T02:34:02+02:00","author":{"@type":"Person","name":"Serhii Vasylenko"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://devdosvid.blog/2021/01/19/mac1-metal-EC2-Instance-user-experience.html"},"publisher":{"@type":"Person","name":"devDosvid — my engineering experience","logo":{"@type":"ImageObject","url":"https://devdosvid.blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://devdosvid.blog accesskey=h title="🏠 Home (Alt + H)">🏠 Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://devdosvid.blog/index.xml title="RSS Feed"><span>RSS Feed</span></a></li><li><a href=https://devdosvid.blog/archive title="All posts"><span>All posts</span></a></li><li><a href=https://devdosvid.blog/about/ title="About me"><span>About me</span></a></li><li><a href=https://devdosvid.blog/cv/ title="My CV"><span>My CV</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://devdosvid.blog>Home</a>&nbsp;»&nbsp;<a href=https://devdosvid.blog/posts/>Posts</a></div><h1 class=post-title>mac1.metal and mac2.metal EC2 Instances — user experience</h1><div class=post-description>Apple macOS development ecosystem with the power of AWS Cloud</div><div class=post-meta><span title='2021-01-19 00:00:00 +0000 UTC'>January 19, 2021</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1503 words&nbsp;·&nbsp;Serhii Vasylenko&nbsp;|&nbsp;<a href=mailto:contact@devdosvid.blog rel="noopener noreferrer" target=_blank>📩 Suggest Changes</a></div></header><figure class=entry-cover><img srcset="https://devdosvid.blog/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience_hu845a664d1b5fb67be87eba39be6c2f34_20656_360x0_resize_q75_box.jpg 360w ,https://devdosvid.blog/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience_hu845a664d1b5fb67be87eba39be6c2f34_20656_480x0_resize_q75_box.jpg 480w ,https://devdosvid.blog/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience_hu845a664d1b5fb67be87eba39be6c2f34_20656_720x0_resize_q75_box.jpg 720w ,https://devdosvid.blog/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg 1000w" sizes="(min-width: 768px) 720px, 100vw" src=https://devdosvid.blog/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg alt width=1000 height=500></figure><div class=post-content><p>This is the review of EC2 Mac instances, <strong>mac1.metal</strong> and <strong>mac2.metal</strong> — the new EC2 instance types that enables macOS workloads on AWS.</p><div class=updatenotice><strong>Updated in June 2022</strong>: new information added about the offering — more cool stuff 🤩</div><p>AWS announced EC2 macOS instances based on the Intel CPU on 30 November 2020.</p><p>After a year and a half, the M1 Mac Instances arrived (7 July 2022).</p><p>Some basic information about the Mac EC2 first:</p><ul><li><p>The <strong>mac1.metal</strong> instances are Intel-based</p><p>12 vCPU, 32 GiB RAM | 10 Gbps Network and 8 Gbps EBS bandwidth</p></li><li><p>The <strong>mac2.metal</strong> instances are powered by M1 Apple Silicon processors.</p><p>8 vCPU, 16 GiB RAM, 16 core Apple Neural Engine | 10 Gbps Network and 8 Gbps EBS bandwidth</p></li><li><p>The Instance must be placed onto a <a href=https://aws.amazon.com/ec2/dedicated-hosts/>Dedicated Host</a> because these are physical Apple Mac minis.</p></li><li><p>AWS has integrated the <a href=https://aws.amazon.com/ec2/nitro/>Nitro System</a> to make Macs work as EC2 instances and connect them with many other services.</p><p>Mac minis are connected to the AWS Nitro via Thunderbolt, just a fun fact.</p></li><li><p>You don&rsquo;t pay anything for the Instance itself, but you pay for the Dedicated Host leasing, and the minimum lease time is 24 hours.</p></li></ul><h2 id=ec2-mac-instance-prices-june-2022>EC2 Mac Instance Prices (June 2022)<a hidden class=anchor aria-hidden=true href=#ec2-mac-instance-prices-june-2022>#</a></h2><p>On-demand pricing (us-east-1, North Virginia:</p><ul><li>mac1.metal costs 1.083 USD per hour or about 780 USD per month</li><li>mac2.metal costs 0.65 USD per hour or about 470 USD per month</li></ul><div class=attention>The mac2.metal costs 40% less compared to the mac1.metal</div><p>Since the minimal leas time for the mac*.metal dedicated host is 24 hours, the first launch of the Instance is always costly, mind that while testing.</p><p>One day of mac1.metal usage costs 26 USD</p><p>One day of mac2.metal usage costs 15.6 USD</p><p>To save yourself some money, you can use <a href=https://aws.amazon.com/savingsplans/compute-pricing/>Savings Plans</a>, both Instance and Compute, and save up to 44% off On-Demand pricing.</p><p>For example, with the one-year commitment, partial 50% upfront payment, and the Instance Savings pricing model, you can get the 20% lower price per hour:</p><ul><li>mac1.metal — 0.867 USD</li><li>mac2.metal — 0.52 USD</li></ul><p>Feel free to play with the numbers in the <a href=https://calculator.aws/#/createCalculator/EC2DedicatedHosts>Dedicated Host Pricing Calculator</a></p><h2 id=supported-operating-systems-june-2022>Supported Operating Systems (June 2022)<a hidden class=anchor aria-hidden=true href=#supported-operating-systems-june-2022>#</a></h2><ul><li>macOS Mojave 10.14.x (mac1.metal only)</li><li>macOS Catalina 10.15.x (mac1.metal only)</li><li>macOS Big Sur 11.x</li><li>macOS Monterey 12.x</li></ul><h2 id=what-can-it-do>What can it do<a hidden class=anchor aria-hidden=true href=#what-can-it-do>#</a></h2><p>Here is a list of some features that the mac1.metal and mac2.metal instances have:</p><ul><li><p>It lives in your VPC because it is an EC2 Instance, so you can access many other services.</p></li><li><p>For EBS, it supports the attachment of up to 16 volumes for mac1 and 10 for mac2.</p></li><li><p>It supports SSM Agent and Session Manager.</p></li><li><p>It has several AWS tools pre-installed: AWS CLI, SSM Agent, EFS Utils, and more.</p></li><li><p>It has pre-installed Enhanced Network Interface drivers. My test upload/download to S3 was about 300GB/s.</p></li><li><p>It can report CPU metrics to CloudWatch.</p></li><li><p>It supports <a href=https://devdosvid.blog/2021/10/24/auto-scaling-group-for-your-macos-ec2-instances-fleet/>AutoScaling</a> 🚀</p></li><li><p>And you can share the instances using <a href=https://devdosvid.blog/2021/09/25/aws-resource-access-manager-multi-account-resource-governance/>AWS Resource Access Manager</a>.</p><p>For example, you can have a dedicated AWS account used solely as a MacOS-based farm in your organization where instances are shared with other accounts.</p></li><li><p>Although there is a local SSD disk available, EC2 Mac can boot only from the EBS</p></li></ul><div class=attention><p>The built-it physical SSD is still there and yours to use: build-cache, temporary storage, etc.</p><p>However, AWS does not manage or support the Apple hardware&rsquo;s internal SSD. So there is no guarantee for data persistency.</p></div><h2 id=what-cant-it-do>What can&rsquo;t it do<a hidden class=anchor aria-hidden=true href=#what-cant-it-do>#</a></h2><ul><li>It can&rsquo;t recognize the attached EBS if you connected it while the instance was running — you must reboot the instance to make it visible.</li><li>It does not recognize the live resize of EBS either — you must reboot the instance so resize change can take effect.</li><li>And the same relates to the Elastic Network Interfaces — attach and reboot the instance to apply it.</li><li>It does not support several services that rely on additional custom software, such as &ldquo;EC2 Instance Connect&rdquo; and &ldquo;AWS Inspect.&rdquo; But I think that AWS will add macOS distros for those soon.</li></ul><h2 id=launching-the-instance>Launching the Instance<a hidden class=anchor aria-hidden=true href=#launching-the-instance>#</a></h2><figure><img loading=lazy src=launch.png width=400 height=200></figure><p>Jeff Bar <a href=https://aws.amazon.com/blogs/aws/new-use-mac-instances-to-build-test-macos-ios-ipados-tvos-and-watchos-apps/>published</a> an excellent how-to about kickstart of the &ldquo;mac1.metal&rdquo;, so I will focus on things he did not mention.</p><p>Once you allocated the Dedicated Host and launched an Instance, the underlying system connects the EBS with a root file system to the Mac Mini.</p><p>The Mac metal Instances can boot from the EBS-backed macOS AMIs only.</p><p>If you specified the EBS size to be more than AMI&rsquo;s default, you need to resize the disk inside the system manually after the boot <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><p>The time from the Instance launch until you can SSH into it varies between 5 and 20 minutes.</p><p>You have the option to access it over SSH with your private key. For example, if you need to set up Screen Sharing, you must allow it through the &ldquo;kickstart&rdquo; command-line utility and set the user password <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><h2 id=customizing-the-instance>Customizing the Instance<a hidden class=anchor aria-hidden=true href=#customizing-the-instance>#</a></h2><p><figure><img loading=lazy src=customize.png width=400 height=200></figure>I wrote a separate post about mac1.metal AMI customization and creation, so check it out!</p><p><a href=https://devdosvid.blog/2021/02/01/customizing-mac1-metal-ec2-ami.html><strong>Customizing mac1.metal EC2 AMI — new guts, more glory</strong></a></p><p>Though, I would like to mention two things here:</p><ol><li>System updates are disabled by default in the macOS AMIs provided by AWS.</li></ol><p>But you can use them with no issues. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo softwareupdate --install --all
</span></span></code></pre></div><ol start=2><li>It is possible to set a custom screen resolution when connected to the instance using native ScreenSharing or any other VNC-compatible software.</li></ol><p>There are many tools, but AWS suggests the <a href=https://github.com/jakehilborn/displayplacer>displayplacer</a>.</p><h2 id=destroying-the-instance>Destroying the Instance<a hidden class=anchor aria-hidden=true href=#destroying-the-instance>#</a></h2><p><figure><img loading=lazy src=cleanup.png width=400 height=200></figure>Such an easy thing to do, right? Well, it depends.</p><p>The complex Instance scrubbing process begins when you click on the &ldquo;Terminate&rdquo; item in the Instance actions menu.</p><p>AWS wants to ensure that anyone who uses the Host (Mac mini) after you will get your data stored neither on disks (including the physical SSD mentioned earlier) nor inside memory or NVRAM, nor anywhere else.</p><p>AWS does not share many details of this scrubbing process, but it takes more than an hour to complete.</p><p>When scrubbing is started, the Dedicated Host transitions to the Pending state.</p><p>Dedicated Host transitions to Available state once scrubbing is finished. But you must wait for another 10-15 minutes to be able to release it finally.</p><p>I don&rsquo;t know why they set the Available state value earlier than the Host is available for operations, but this is how it works now (Jan'21).</p><p>Therefore, you can launch the next Instance on the same Host no earlier than ~1,5 hours after you terminated the previous one. That doesn&rsquo;t seem very pleasant in the first couple of weeks, but you will get used to it. 😄</p><p>And again: you can release the &ldquo;mac1.metal&rdquo; Dedicated Host no earlier than 24 hours after it was allocated. So plan your tests wisely.</p><div class=attention>If the lease time of a host is more than 24 hours, you don’t need to wait for the scrubbing process to finish to release that host.</div><h2 id=legal-things>Legal things<a hidden class=anchor aria-hidden=true href=#legal-things>#</a></h2><p>It is a bit tricky thing, but in short words:</p><ul><li>you are allowed to use the Instances solely for developer purposes</li><li>you must agree to all software EULAs on the system</li></ul><p>Here is the license agreement of the macOS Monterey if you want to deal with it like a pro — <a href=https://www.apple.com/legal/sla/docs/macOSMonterey.pdf>link</a>.</p><h2 id=some-more-cool-stuff-to-check>Some more cool stuff to check:<a hidden class=anchor aria-hidden=true href=#some-more-cool-stuff-to-check>#</a></h2><p><a href=https://github.com/aws/ec2-macos-init>EC2 macOS Init</a> launch daemon, which initializes Mac instances.
<a href=https://github.com/aws/homebrew-aws>EC2 macOS Homebrew Tap</a> (Third-Party Repository) with several management tools which come pre-installed into macOS AMI from AWS.</p><p>Indeed it is powerful, and it has its trade-offs, such as price and some technical constraints. But it is an actual macOS device natively integrated into the AWS environment. So I guess it is worth to be tried!</p><p>Thanks for reading this! Stay tuned for more user experience feedback about baking custom AMIs, automated software provisioning with Ansible, and other adventures with mac1.metal!</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><strong>How to resize the EBS at mac1.metal in Terminal</strong></p><p>Get the identifier of EBS (look for the first one with GUID_partition_scheme):
<code>diskutil list physical external</code></p><p>Or here is a more advanced version to be used in a script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>DISK_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>diskutil list physical external | grep <span style=color:#e6db74>&#39;GUID_partition_scheme&#39;</span>| tr -s <span style=color:#e6db74>&#39; &#39;</span> | cut -d<span style=color:#e6db74>&#39; &#39;</span> -f6<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>It would probably be <code>disk0</code> if you did not attach additional EBS.</p><p>Then run the repair job for the disk, using its identifier:
<code>diskutil repairDisk disk0</code></p><p>Advanced version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yes | diskutil repairDisk $DISK_ID
</span></span></code></pre></div><p>Now get the APFS container identifier (look for Apple_APFS):
<code>diskutil list physical external</code></p><p>Advanced version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>APFS_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>diskutil list physical external | grep <span style=color:#e6db74>&#39;Apple_APFS&#39;</span> | tr -s <span style=color:#e6db74>&#39; &#39;</span> | cut -d<span style=color:#e6db74>&#39; &#39;</span> -f8<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>It would probably be <code>disk0s2</code> if you did not attach additional EBS.</p><p>Finally, resize the APFS container:
<code>diskutil apfs resizeContainer disk0s2</code></p><p>Advanced version</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>diskutil apfs resizeContainer $APFS_ID
</span></span></code></pre></div>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></li><li id=fn:2><p><strong>How to setup Screen Sharing at mac1.metal in Terminal</strong></p><p>The <code>kickstart</code> command-line tool resides in <code>/System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/</code> so you&rsquo;ll better to cd into that directory for convenience:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Turn On Remote Management for a user to be specified later</span>
</span></span><span style=display:flex><span>sudo ./kickstart -activate -configure -allowAccessFor -specifiedUsers
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e># Enable Remote Management for ec2-user user</span>
</span></span><span style=display:flex><span>sudo ./kickstart -configure -users ec2-user -access -on -privs -all
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e># Set the user password </span>
</span></span><span style=display:flex><span>sudo passwd ec2-user
</span></span></code></pre></div>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></li></ol></div></div><footer class=post-footer><div class="sp-form-outer sp-force-hide"><div id=sp-form-211745 sp-id=211745 sp-hash=9ef750f82b8d5e11b34ea23df27756cb738d703108d46ebff940b44ce4757404 sp-lang=en class="sp-form sp-form-regular sp-form-embed"><div class=sp-form-fields-wrapper><div class=sp-message><div></div></div><form novalidate class=sp-element-container><div class="sp-field sp-field-full-width-add sp-field-full-width sp-field-full-width-add-active" sp-id=sp-d7ac453c-4371-4ac2-94ad-209ba95924ce data-><div><h3>Subscribe to be notified about blog updates!</h3></div></div><div class=sp-field sp-id=sp-07c6298b-0a1a-4417-b7d9-b2205b910fc7><label class=sp-control-label><span>Email</span><strong>*</strong></label><input type=email sp-type=email name=sform[email] class=sp-form-control placeholder=username@example.com sp-tips=%7B%22required%22%3A%22Required%20field%22%2C%22wrong%22%3A%22Wrong%20email%22%7D autocomplete=on required></div><div class="sp-field sp-button-container" sp-id=sp-92706abe-5113-4db0-b255-c64ad75a46f7><button id=sp-92706abe-5113-4db0-b255-c64ad75a46f7 class=sp-button>Subscribe</button></div></form></div></div></div><script type=text/javascript async src=//web.webformscr.com/apps/fc3/build/default-handler.js?1651223786960></script><div class=post-series><p>Check out other posts of the <b>"mac1.metal at AWS"</b> series:</p><ul><li><a href="https://devdosvid.blog/2021/10/24/auto-scaling-group-for-your-macos-ec2-instances-fleet/?utm_blogseries=mac1.metal-at-aws">Auto Scaling Group for your macOS EC2 Instances fleet</a></li><li><a href="https://devdosvid.blog/2021/05/27/run-ansible-playbook-on-mac1.metal-instances-fleet-with-aws-systems-manager/?utm_blogseries=mac1.metal-at-aws">Run Ansible playbook on mac1.metal instances fleet with AWS Systems Manager</a></li><li><a href="https://devdosvid.blog/2021/02/01/customizing-mac1-metal-ec2-ami.html?utm_blogseries=mac1.metal-at-aws">Customizing mac1.metal EC2 AMI — new guts, more glory</a></li><li><a href="https://devdosvid.blog/2021/01/20/terraforming-mac1-metal-at-AWS.html?utm_blogseries=mac1.metal-at-aws">Terraforming mac1.metal at AWS</a></li><li style=opacity:.75>mac1.metal and mac2.metal EC2 Instances — user experience</li></ul></div><ul class=post-tags></ul><div class=license><p>This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nd/4.0/>Creative Commons Attribution-NoDerivatives 4.0 International License</a></p></div><nav class=paginav><a class=prev href=https://devdosvid.blog/2021/01/20/terraforming-mac1-metal-at-AWS.html><span class=title>« Prev</span><br><span>Terraforming mac1.metal at AWS</span></a>
<a class=next href=https://devdosvid.blog/2020/12/16/aws-cloudshell.html><span class=title>Next »</span><br><span>AWS CloudShell</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://devdosvid.blog>devDosvid — my engineering experience</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>