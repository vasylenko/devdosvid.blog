<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>mac1.metal EC2 Instance ‚Äî user experience | Serhii Vasylenko</title>
<meta name=keywords content="aws,macos,ec2">
<meta name=description content="An overview of one-month user experience with the new mac1.metal EC2 Instances from AWS">
<meta name=author content="Serhii Vasylenko">
<link rel=canonical href=https://serhii.vasylenko.info/2021/01/19/mac1-metal-EC2-Instance-user-experience.html>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.9d0ee5f7e9290da0756b77773249ca87656d25d05fe5e05caecbace6c375a707.css integrity="sha256-nQ7l9+kpDaB1a3d3MknKh2VtJdBf5eBcrsus5sN1pwc=" rel="preload stylesheet" as=style>
<link rel=preload href=/apple-touch-icon.png as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://serhii.vasylenko.info/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://serhii.vasylenko.info/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://serhii.vasylenko.info/favicon-32x32.png>
<link rel=apple-touch-icon href=https://serhii.vasylenko.info/apple-touch-icon.png>
<link rel=mask-icon href=https://serhii.vasylenko.info/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GK7SE0XWGK"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-GK7SE0XWGK',{anonymize_ip:!1})}</script>
<meta property="og:title" content="mac1.metal EC2 Instance ‚Äî user experience">
<meta property="og:description" content="An overview of one-month user experience with the new mac1.metal EC2 Instances from AWS">
<meta property="og:type" content="article">
<meta property="og:url" content="https://serhii.vasylenko.info/2021/01/19/mac1-metal-EC2-Instance-user-experience.html">
<meta property="og:image" content="https://serhii.vasylenko.info/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-01-19T00:00:00+00:00">
<meta property="article:modified_time" content="2021-01-19T00:00:00+00:00"><meta property="og:site_name" content="Serhii Vasylenko ‚Äî Personal Blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://serhii.vasylenko.info/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg">
<meta name=twitter:title content="mac1.metal EC2 Instance ‚Äî user experience">
<meta name=twitter:description content="An overview of one-month user experience with the new mac1.metal EC2 Instances from AWS">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://serhii.vasylenko.info/posts/"},{"@type":"ListItem","position":3,"name":"mac1.metal EC2 Instance ‚Äî user experience","item":"https://serhii.vasylenko.info/2021/01/19/mac1-metal-EC2-Instance-user-experience.html"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"mac1.metal EC2 Instance ‚Äî user experience","name":"mac1.metal EC2 Instance ‚Äî user experience","description":"An overview of one-month user experience with the new mac1.metal EC2 Instances from AWS","keywords":["aws","macos","ec2"],"articleBody":"Amazon EC2 Mac Instances Something cool and powerful with inevitable trade-offs. As everything in this world.\nAWS announced EC2 macOS-based instances on the 30th of November 2020, and after more than a month of tests, I would like to share some findings and impressions about it.\nFirst of all, the things you can easily find, but it‚Äôs still worth to say:\n The new instance family is called mac1.metal. Guess we should expect mac2 or mac3; otherwise, why did they put a number in the name? They added AWS Nitro System to integrate them with many AWS services. The Instance must be placed onto a Dedicated Host. Only one Instance per Host is allowed because the Host is an actual Mac Mini in that case. You don‚Äôt pay anything for the Instance itself, but you pay for the Dedicated Host leasing ‚Äî $1.083, and the minimum lease time is 24 hours. So the launch of the ‚Äúmac1.metal‚Äù Instance costs $26 at minimum. Prices provided for the cheapest region ‚Äî North Virginia. You can apply Saving Plans to save some money. Mojave (10.14) and Catalina (10.15) are supported at the moment, with ‚Äúsupport for macOS Big Sur (11.0) coming soon‚Äù. I expect it to be in 2021, though.  What can it do Here is a list of some features that the ‚Äúmac1.metal‚Äù instance has:\n It lives in your VPC because it is an EC2 Instance so that you can access many other services. It supports the new gp3 EBS type (and other types as well). It supports SSM Agent and Session Manager. It has several AWS tools pre-installed. It has pre-installed Enhanced Network Interface drivers. My test upload/download to S3 was about 300GB/s. It can report CPU metrics to CloudWatch (if you ever need it, though).  What can‚Äôt it do  It can‚Äôt be used in Auto Scaling because of a Dedicated Host. It can‚Äôt recognize the attached EBS if you connected it while the Instance was running ‚Äî you must reboot the Instance to make it visible. It does not support several services that rely on additional custom software, such as ‚ÄúEC2 Instance Connect‚Äù and ‚ÄúAWS Inspect.‚Äù But I think that AWS will add macOS distros for those soon.  Launching the Instance Jeff Bar published an excellent how-to about kickstart of the ‚Äúmac1.metal‚Äù, so I will focus on things he did not mention.\nOnce you allocated the Dedicated Host and launched an Instance on it, the underlying system connects the EBS with a root file system to the Mac Mini.\nIt is an AMI with 32G EBS (as per Jan'21) with macOS pre-installed.\nThat means two things:\n The built-it physical SSD is still there and still yours to use; however, AWS does not manage or support the Apple hardware‚Äôs internal SSD. You must resize the disk manually (if you specified the EBS size to be more than 32G)[1].  The time from the Instance launch till you‚Äôre able to SSH into it varies between 15 and 20 minutes.\nYou have the option to access it over SSH with your private key. If you need to set up Screen Sharing, you have to allow it through the ‚Äúkickstart‚Äù command-line utility and setting the user password [2].\nDestroying the Instance What an easy thing to do, right? Well, it depends.\nWhen you click on the ‚ÄúTerminate‚Äù item in the Instance actions menu, the complex Instance scrubbing process begins.\nAWS wants to make sure that anyone who uses the Host (Mac mini) after you will get your data stored neither on disks (including physical SSD mentioned earlier), nor inside memory or NVRAM, nor anywhere else. They do not share the info about this scrubbing process‚Äôs details, but it takes more than an hour to complete.\nWhen scrubbing is started, the Dedicated Host transitions to the Pending state. Dedicated Host transitions to Available state once scrubbing is finished. But you must wait for another 10-15 minutes to be able to release it finally.\nI don‚Äôt know why they set the Available state value earlier than the Host is available for operations, but this is how it works now (Jan'21).\nTherefore, you can launch the next Instance on the same Host not earlier than ~1,5 hours after you terminated the previous. That doesn‚Äôt seem very pleasant in the first couple of weeks, but you will get used to it. üòÑ\nAnd again: you can release the ‚Äúmac1.metal‚Äù Dedicated Host not earlier than 24 hours after it was allocated. So plan your tests wisely.\nLegal things I could not find it on a documentation page, but A Cloud Guru folks say that you must use new Instances solely for developer services, and you must agree to all of the EULAs.\nSounds reasonable to me, but that could be written somewhere in the docs still, at least. Please let me know if you found it there.\nSome more cool stuff to check: EC2 macOS Init launch daemon, which is used to initialize Mac instances. EC2 macOS Homebrew Tap (Third-Party Repository) with several management tools which come pre-installed into macOS AMI from AWS.\n Indeed it is powerful, and it has its trade-offs, such as price and some technical constraints. But it is a real MacOS device natively integrated into the AWS environment. So I guess it worth to be tried!\nThanks for reading this! Stay tuned for more user experience feedback about baking custom AMI‚Äôs, automated software provisioning with Ansible, and other adventures with mac1.metal!\n [1] How to resize the EBS at mac1.metal in Terminal\nGet the identifier of EBS (look for the first one with GUID_partition_scheme):\ndiskutil list physical external\nOr here is a more advanced version to be used in a script:\n1  DISK_ID=$(diskutil list physical external | grep 'GUID_partition_scheme'| tr -s ' ' | cut -d' ' -f6)   It would probably be disk0 if you did not attach additional EBS.\nThen run the repair job for the disk, using its identifier: diskutil repairDisk disk0\nAdvanced version:\n1  yes | diskutil repairDisk $DISK_ID   Now get the APFS container identifier (look for Apple_APFS): diskutil list physical external\nAdvanced version:\n1  APFS_ID=$(diskutil list physical external | grep 'Apple_APFS' | tr -s ' ' | cut -d' ' -f8)   It would probably be disk0s2 if you did not attach additional EBS.\nFinally, resize the APFS container: diskutil apfs resizeContainer disk0s2\nAdvanced version\n1  diskutil apfs resizeContainer $APFS_ID   [2]How to setup Screen Sharing at mac1.metal in Terminal\nThe kickstart command-line tool resides in /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/ so you‚Äôll better to cd into that directory for convenience:\n1 2 3 4 5 6 7 8  # Turn On Remote Management for a user to be specified later sudo ./kickstart -activate -configure -allowAccessFor -specifiedUsers # Enable Remote Management for ec2-user user sudo ./kickstart -configure -users ec2-user -access -on -privs -all # Set the user password  sudo passwd ec2-user   ","wordCount":"1131","inLanguage":"en","image":"https://serhii.vasylenko.info/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg","datePublished":"2021-01-19T00:00:00Z","dateModified":"2021-01-19T00:00:00Z","author":{"@type":"Person","name":"Serhii Vasylenko"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://serhii.vasylenko.info/2021/01/19/mac1-metal-EC2-Instance-user-experience.html"},"publisher":{"@type":"Person","name":"Serhii Vasylenko","logo":{"@type":"ImageObject","url":"https://serhii.vasylenko.info/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://serhii.vasylenko.info accesskey=h title="Home (Alt + H)">
<img src=/apple-touch-icon.png alt=logo aria-label=logo height=" 30px">Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://serhii.vasylenko.info/categories/ title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://serhii.vasylenko.info/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://serhii.vasylenko.info/about/ title="About me">
<span>About me</span>
</a>
</li>
<li>
<a href=https://serhii.vasylenko.info/cv/ title="My CV">
<span>My CV</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://serhii.vasylenko.info>Home</a>&nbsp;¬ª&nbsp;<a href=https://serhii.vasylenko.info/posts/>Posts</a></div>
<h1 class=post-title>
mac1.metal EC2 Instance ‚Äî user experience
</h1>
<div class=post-description>
An overview of one-month user experience with the new mac1.metal EC2 Instances from AWS
</div>
<div class=post-meta>January 19, 2021&nbsp;¬∑&nbsp;Serhii Vasylenko&nbsp;|&nbsp;<a href=mailto:email-from-blog@vasylenko.info rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<figure class=entry-cover>
<img loading=lazy srcset="https://serhii.vasylenko.info/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience_hu845a664d1b5fb67be87eba39be6c2f34_20656_360x0_resize_q75_box.jpg 360w ,https://serhii.vasylenko.info/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience_hu845a664d1b5fb67be87eba39be6c2f34_20656_480x0_resize_q75_box.jpg 480w ,https://serhii.vasylenko.info/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience_hu845a664d1b5fb67be87eba39be6c2f34_20656_720x0_resize_q75_box.jpg 720w ,https://serhii.vasylenko.info/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg 1000w" sizes="(min-width: 768px) 720px, 100vw" src=https://serhii.vasylenko.info/2021/01/19/2021-01-19-mac1-metal-EC2-Instance-user-experience.jpg alt width=1000 height=500>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#amazon-ec2-mac-instances aria-label="Amazon EC2 Mac Instances">Amazon EC2 Mac Instances</a></li>
<li>
<a href=#what-can-it-do aria-label="What can it do">What can it do</a></li>
<li>
<a href=#what-cant-it-do aria-label="What can&amp;rsquo;t it do">What can&rsquo;t it do</a></li>
<li>
<a href=#launching-the-instance aria-label="Launching the Instance">Launching the Instance</a></li>
<li>
<a href=#destroying-the-instance aria-label="Destroying the Instance">Destroying the Instance</a></li>
<li>
<a href=#legal-things aria-label="Legal things">Legal things</a></li>
<li>
<a href=#some-more-cool-stuff-to-check aria-label="Some more cool stuff to check:">Some more cool stuff to check:</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=amazon-ec2-mac-instances>Amazon EC2 Mac Instances<a hidden class=anchor aria-hidden=true href=#amazon-ec2-mac-instances>#</a></h2>
<p>Something cool and powerful with inevitable trade-offs. As everything in this world.</p>
<p>AWS announced EC2 macOS-based instances on the 30th of November 2020, and after more than a month of tests, I would like to share some findings and impressions about it.</p>
<p>First of all, the things you can easily find, but it&rsquo;s still worth to say:</p>
<ul>
<li>The new instance family is called <code>mac1.metal</code>. Guess we should expect mac2 or mac3; otherwise, why did they put a number in the name?</li>
<li>They added <a href=https://aws.amazon.com/ec2/nitro/>AWS Nitro System</a> to integrate them with many AWS services.</li>
<li>The Instance must be placed onto a <a href=https://aws.amazon.com/ec2/dedicated-hosts/>Dedicated Host</a>. Only one Instance per Host is allowed because the Host is an actual Mac Mini in that case.</li>
<li>You don&rsquo;t pay anything for the Instance itself, but you pay for the Dedicated Host leasing ‚Äî $1.083, and the minimum lease time is 24 hours. So the launch of the &ldquo;mac1.metal&rdquo; Instance costs $26 at minimum. Prices provided for the cheapest region ‚Äî North Virginia.</li>
<li>You can apply <a href=https://docs.aws.amazon.com/savingsplans/latest/userguide/what-is-savings-plans.html>Saving Plans</a> to save some money.</li>
<li>Mojave (10.14) and Catalina (10.15) are supported at the moment, with <a href=https://aws.amazon.com/ec2/instance-types/mac/>&ldquo;support for macOS Big Sur (11.0) coming soon&rdquo;</a>. I expect it to be in 2021, though.</li>
</ul>
<h2 id=what-can-it-do>What can it do<a hidden class=anchor aria-hidden=true href=#what-can-it-do>#</a></h2>
<p>Here is a list of some features that the &ldquo;mac1.metal&rdquo; instance has:</p>
<ul>
<li>It lives in your VPC because it is an EC2 Instance so that you can access many other services.</li>
<li>It supports the new gp3 EBS type (and other types as well).</li>
<li>It supports SSM Agent and Session Manager.</li>
<li>It has several AWS tools pre-installed.</li>
<li>It has pre-installed Enhanced Network Interface drivers. My test upload/download to S3 was about 300GB/s.</li>
<li>It can report CPU metrics to CloudWatch (if you ever need it, though).</li>
</ul>
<h2 id=what-cant-it-do>What can&rsquo;t it do<a hidden class=anchor aria-hidden=true href=#what-cant-it-do>#</a></h2>
<ul>
<li>It can&rsquo;t be used in Auto Scaling because of a Dedicated Host.</li>
<li>It can&rsquo;t recognize the attached EBS if you connected it while the Instance was running ‚Äî you must reboot the Instance to make it visible.</li>
<li>It does not support several services that rely on additional custom software, such as &ldquo;EC2 Instance Connect&rdquo; and &ldquo;AWS Inspect.&rdquo; But I think that AWS will add macOS distros for those soon.</li>
</ul>
<h2 id=launching-the-instance>Launching the Instance<a hidden class=anchor aria-hidden=true href=#launching-the-instance>#</a></h2>
<p>Jeff Bar <a href=https://aws.amazon.com/blogs/aws/new-use-mac-instances-to-build-test-macos-ios-ipados-tvos-and-watchos-apps/>published</a> an excellent how-to about kickstart of the &ldquo;mac1.metal&rdquo;, so I will focus on things he did not mention.</p>
<p>Once you allocated the Dedicated Host and launched an Instance on it, the underlying system connects the EBS with a root file system to the Mac Mini.</p>
<p>It is an AMI with 32G EBS (as per Jan'21) with macOS pre-installed.</p>
<p>That means two things:</p>
<ul>
<li>The built-it physical SSD is still there and still yours to use; however, AWS does not manage or support the Apple hardware&rsquo;s internal SSD.</li>
<li>You must resize the disk manually (if you specified the EBS size to be more than 32G)[1].</li>
</ul>
<p>The time from the Instance launch till you&rsquo;re able to SSH into it varies between 15 and 20 minutes.</p>
<p>You have the option to access it over SSH with your private key. If you need to set up Screen Sharing, you have to allow it through the &ldquo;kickstart&rdquo; command-line utility and setting the user password [2].</p>
<h2 id=destroying-the-instance>Destroying the Instance<a hidden class=anchor aria-hidden=true href=#destroying-the-instance>#</a></h2>
<p>What an easy thing to do, right? Well, it depends.</p>
<p>When you click on the &ldquo;Terminate&rdquo; item in the Instance actions menu, the complex Instance scrubbing process begins.</p>
<p>AWS wants to make sure that anyone who uses the Host (Mac mini) after you will get your data stored neither on disks (including physical SSD mentioned earlier), nor inside memory or NVRAM, nor anywhere else. They do not share the info about this scrubbing process&rsquo;s details, but it takes more than an hour to complete.</p>
<p>When scrubbing is started, the Dedicated Host transitions to the Pending state. Dedicated Host transitions to Available state once scrubbing is finished. But you must wait for another 10-15 minutes to be able to release it finally.</p>
<p>I don&rsquo;t know why they set the Available state value earlier than the Host is available for operations, but this is how it works now (Jan'21).</p>
<p>Therefore, you can launch the next Instance on the same Host not earlier than ~1,5 hours after you terminated the previous. That doesn&rsquo;t seem very pleasant in the first couple of weeks, but you will get used to it. üòÑ</p>
<p>And again: you can release the &ldquo;mac1.metal&rdquo; Dedicated Host not earlier than 24 hours after it was allocated. So plan your tests wisely.</p>
<h2 id=legal-things>Legal things<a hidden class=anchor aria-hidden=true href=#legal-things>#</a></h2>
<p>I could not find it on a documentation page, but A Cloud Guru folks <a href=https://acloudguru.com/blog/engineering/what-you-need-to-know-about-awss-new-ec2-mac-instances>say</a> that you must use new Instances solely for developer services, and you must agree to all of the EULAs.</p>
<p>Sounds reasonable to me, but that could be written somewhere in the docs still, at least. Please let me know if you found it there.</p>
<h2 id=some-more-cool-stuff-to-check>Some more cool stuff to check:<a hidden class=anchor aria-hidden=true href=#some-more-cool-stuff-to-check>#</a></h2>
<p><a href=https://github.com/aws/ec2-macos-init>EC2 macOS Init</a> launch daemon, which is used to initialize Mac instances.
<a href=https://github.com/aws/homebrew-aws>EC2 macOS Homebrew Tap</a> (Third-Party Repository) with several management tools which come pre-installed into macOS AMI from AWS.</p>
<hr>
<p>Indeed it is powerful, and it has its trade-offs, such as price and some technical constraints. But it is a real MacOS device natively integrated into the AWS environment. So I guess it worth to be tried!</p>
<p>Thanks for reading this! Stay tuned for more user experience feedback about baking custom AMI&rsquo;s, automated software provisioning with Ansible, and other adventures with mac1.metal!</p>
<hr>
<p><strong>[1] How to resize the EBS at mac1.metal in Terminal</strong></p>
<p>Get the identifier of EBS (look for the first one with GUID_partition_scheme):</p>
<p><code>diskutil list physical external</code></p>
<p>Or here is a more advanced version to be used in a script:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>DISK_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>diskutil list physical external | grep <span style=color:#e6db74>&#39;GUID_partition_scheme&#39;</span>| tr -s <span style=color:#e6db74>&#39; &#39;</span> | cut -d<span style=color:#e6db74>&#39; &#39;</span> -f6<span style=color:#66d9ef>)</span>
</code></pre></td></tr></table>
</div>
</div><p>It would probably be <code>disk0</code> if you did not attach additional EBS.</p>
<p>Then run the repair job for the disk, using its identifier:
<code>diskutil repairDisk disk0</code></p>
<p>Advanced version:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>yes | diskutil repairDisk $DISK_ID
</code></pre></td></tr></table>
</div>
</div><p>Now get the APFS container identifier (look for Apple_APFS):
<code>diskutil list physical external</code></p>
<p>Advanced version:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>APFS_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>diskutil list physical external | grep <span style=color:#e6db74>&#39;Apple_APFS&#39;</span> | tr -s <span style=color:#e6db74>&#39; &#39;</span> | cut -d<span style=color:#e6db74>&#39; &#39;</span> -f8<span style=color:#66d9ef>)</span>
</code></pre></td></tr></table>
</div>
</div><p>It would probably be <code>disk0s2</code> if you did not attach additional EBS.</p>
<p>Finally, resize the APFS container:
<code>diskutil apfs resizeContainer disk0s2</code></p>
<p>Advanced version</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>diskutil apfs resizeContainer $APFS_ID
</code></pre></td></tr></table>
</div>
</div><p><strong>[2]How to setup Screen Sharing at mac1.metal in Terminal</strong></p>
<p>The <code>kickstart</code> command-line tool resides in <code>/System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/</code> so you&rsquo;ll better to cd into that directory for convenience:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># Turn On Remote Management for a user to be specified later</span>
sudo ./kickstart -activate -configure -allowAccessFor -specifiedUsers

<span style=color:#75715e># Enable Remote Management for ec2-user user</span>
sudo ./kickstart -configure -users ec2-user -access -on -privs -all

<span style=color:#75715e># Set the user password </span>
sudo passwd ec2-user
</code></pre></td></tr></table>
</div>
</div>
</div>
<footer class=post-footer>
<p> If you liked the article, please <b>support me by sharing</b> it on social networks üôè</p>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share mac1.metal EC2 Instance ‚Äî user experience on twitter" href="https://twitter.com/intent/tweet/?text=mac1.metal%20EC2%20Instance%20%e2%80%94%20user%20experience&url=https%3a%2f%2fserhii.vasylenko.info%2f2021%2f01%2f19%2fmac1-metal-EC2-Instance-user-experience.html&hashtags=aws%2cmacos%2cec2"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share mac1.metal EC2 Instance ‚Äî user experience on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fserhii.vasylenko.info%2f2021%2f01%2f19%2fmac1-metal-EC2-Instance-user-experience.html&title=mac1.metal%20EC2%20Instance%20%e2%80%94%20user%20experience&summary=mac1.metal%20EC2%20Instance%20%e2%80%94%20user%20experience&source=https%3a%2f%2fserhii.vasylenko.info%2f2021%2f01%2f19%2fmac1-metal-EC2-Instance-user-experience.html"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share mac1.metal EC2 Instance ‚Äî user experience on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fserhii.vasylenko.info%2f2021%2f01%2f19%2fmac1-metal-EC2-Instance-user-experience.html&title=mac1.metal%20EC2%20Instance%20%e2%80%94%20user%20experience"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share mac1.metal EC2 Instance ‚Äî user experience on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fserhii.vasylenko.info%2f2021%2f01%2f19%2fmac1-metal-EC2-Instance-user-experience.html"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
</div>
<ul class=post-tags>
<li><a href=https://serhii.vasylenko.info/tags/aws/>aws</a></li>
<li><a href=https://serhii.vasylenko.info/tags/macos/>macos</a></li>
<li><a href=https://serhii.vasylenko.info/tags/ec2/>ec2</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://serhii.vasylenko.info/2021/01/20/terraforming-mac1-metal-at-AWS.html>
<span class=title>¬´ Prev Page</span>
<br>
<span>Terraforming mac1.metal at AWS</span>
</a>
<a class=next href=https://serhii.vasylenko.info/2020/12/16/aws-cloudshell.html>
<span class=title>Next Page ¬ª</span>
<br>
<span>AWS CloudShell</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://serhii.vasylenko.info>Serhii Vasylenko</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>